webpackJsonp([2],[function(e,r,t){function n(){return new u({before:function(){b.clearColor(0,0,0,0),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT)},renderOrder:1,getUniforms:function(){return{camera:E.computeMatrix()}},factory:function(){var e=100,r=new f.Float(e,4),t=new d(function(){return"  gl_Position = camera * position; \n  f_color = colors[int(color)]; \n"},function(){return"  gl_FragColor = f_color ;\n"});t.attributes.position="vec4",t.attributes.color="float",t.varyings.f_color="vec4",t.vertex_uniforms.camera="mat4",t.vertex_uniforms["colors["+e+"]"]="vec4";var n=new l(this,t,100);return n.addAttribute("position",4,"Float32Array",function(e,r){return r.vertices[e]}),n.addAttribute("color",1,"Float32Array",function(e,t){return[r.add(t.color,t,function(){return t.color.color})]}),n.uniforms.colors=r.buffer,n}})}function o(e,r){var t=[b.TEXTURE_CUBE_MAP_POSITIVE_X,b.TEXTURE_CUBE_MAP_NEGATIVE_X,b.TEXTURE_CUBE_MAP_POSITIVE_Y,b.TEXTURE_CUBE_MAP_NEGATIVE_Y,b.TEXTURE_CUBE_MAP_POSITIVE_Z,b.TEXTURE_CUBE_MAP_NEGATIVE_Z];this.size=e,this.depth=r;var n={texture:a.createTexture(b,{target:b.TEXTURE_CUBE_MAP,width:this.size,height:this.size,min:b.LINEAR,mag:b.LINEAR,format:b.RGBA,type:b.UNSIGNED_BYTE,wrapS:b.CLAMP_TO_EDGE,wrapT:b.CLAMP_TO_EDGE})};if(this.depth){var o=b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,o),b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_COMPONENT16,this.size,this.size)}this.framebuffers=[];for(var i=0;6>i;++i){var c=b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,c),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,t[i],n.texture,0),this.depth&&b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,o);var u=b.checkFramebufferStatus(b.FRAMEBUFFER);if(u!=b.FRAMEBUFFER_COMPLETE)throw"gl.checkFramebufferStatus() returned "+WebGLDebugUtils.glEnumToString(u);this.framebuffers.push(c)}b.bindRenderbuffer(b.RENDERBUFFER,null),this.texture=n}var a=t(7),i=t(7).m4,c=t(1),u=c.Renderable,l=c.Model,s=c.Plate,d=(c.shaders,c.Shader),f=c.Allocation,m=c.Environment,v=new c({canvas:document.getElementById("canvas"),frameRate:{element:document.getElementById("framerate")},wasd:{document:document,delta:.05,theta:-Math.PI/120}}),E=v.camera,_=v.screen,b=v.screen.gl,F=function(e,r,t,n){return[[e-n,r-n,t,1],[e-n,r+n,t,1],[e+n,r-n,t,1],[e+n,r+n,t,1]]},p={id:"red",color:[1,0,0,1]},R={id:"green",color:[0,1,0,1]},h={id:"blue",color:[0,0,1,1]},g={id:"white",color:[1,1,1,1]},T=n();_.addRenderable(T),T.add({color:p,allocations:{},vertices:F(.25,0,.7,.05)}),T.add({color:R,allocations:{},vertices:F(0,.25,.7,.05)}),T.add({color:h,allocations:{},vertices:F(0,0,.9,.05)}),T.add({color:g,allocations:{},vertices:F(0,0,.7,.01)}),o.prototype.bind=function(e){b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffers[e]),b.viewport(0,0,this.size,this.size)},o.prototype.unbind=function(){b.bindFramebuffer(b.FRAMEBUFFER,null),b.viewport(0,0,b.drawingBufferWidth||b.canvas.width,b.drawingBufferHeight||b.canvas.height)};var A=new o(1024,!0);A.unbind(),function(){var e=new m(A),r=new d(function(){return"  gl_Position = position; \n  v_position  = inverse_camera * position; \n"},function(){return"  gl_FragColor = vec4(                                               \n   (v_position.x + 1.0) / 2.0,                                       \n   (v_position.y + 1.0) / 2.0,                                       \n   (v_position.z + 1.0) / 2.0,                                       \n   1.0);                                                             \n"});r.attributes.position="vec4",r.vertex_uniforms.inverse_camera="mat4",r.varyings.v_position="vec4";var t=new s(r);t.add({z:-.5});var n={},o=i.identity(new Float32Array(16)),a=i.identity(new Float32Array(16)),c=i.identity(new Float32Array(16));e.addRenderable({renderOrder:10,render:function(r){r.disable(r.DEPTH_TEST),e.camera.computeMatrix(),i.inverse(e.camera.perspective,o),i.inverse(e.camera.skyorientation,a),i.multiply(o,a,c),n.inverse_camera=c;var u=t.getGeometry(r);t.drawPrep(u,n),u.draw(),r.enable(r.DEPTH_TEST)}}),_.addRenderable({renderOrder:2,render:function(r){e.render(r)}})}(),function(){var e=new d(function(){return"  v_pos       = camera * position; \n  gl_Position = vec4(position.x, position.y, 0.5, 1.0); \n"},function(){return"  gl_FragColor = textureCube(                            \n      texture,                                           \n      vec3(v_pos.xyz / v_pos.w));                        \n"});e.attributes.position="vec4",e.fragment_uniforms.texture="samplerCube",e.vertex_uniforms.camera="mat4",e.varyings.v_pos="vec4";var r=new s(e);r.textureData={texture:A.texture},r.add({z:1});var t={},n=i.identity(new Float32Array(16));_.addRenderable({renderOrder:3,render:function(e){e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE_MINUS_DST_ALPHA,e.DST_ALPHA,e.ONE,e.ONE),E.computeMatrix(),i.inverse(E.skymatrix,n),t.camera=n,t.texture=r.textureData.texture.texture;var o=r.getGeometry(e);r.drawPrep(o,t),o.draw(),e.disable(e.BLEND),e.enable(e.DEPTH_TEST)}})}(),_.beginFrameRendering(!1)}]);
//# sourceMappingURL=bundle.js.map