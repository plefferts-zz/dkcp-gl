webpackJsonp([1],{0:function(t,e,r){function n(){var t=c.identity(new Float32Array(16));return new l({renderOrder:10,getUniforms:function(e){return e==b?{camera:E.computeMatrix(),camera2:t,hit_test:0}:{camera:e.camera.computeMatrix(),camera2:e.camera2,hit_test:1}},factory:function(){var t=100,e=new p.Float(t,4),r=new R(w.hitColorAllocation,function(){return"  gl_Position = camera2 * camera * position; \n  f_color = colors[int(color)];              \n"},function(){return"  gl_FragColor = f_color; \n"});r.attributes.position="vec4",r.attributes.color="float",r.varyings.f_color="vec4",r.vertex_uniforms.camera="mat4",r.vertex_uniforms.camera2="mat4",r.vertex_uniforms["colors["+t+"]"]="vec4";var n=new h(this,r,100);return w.mixinModel(n),n.addAttribute("position",4,"Float32Array",function(t,e){return e.vertices[t]}),n.addAttribute("color",1,"Float32Array",function(t,r){return[e.add(r.color,r,function(){return r.color.color})]}),n.uniforms.colors=e.buffer,n}})}function o(t){this.framebuffers=t,g.call(this)}function i(t,e){this.size=t,this.depth=e;var r={texture:u.createTexture(y,{target:y.TEXTURE_2D,width:this.size,height:this.size,min:y.LINEAR,mag:y.LINEAR,format:y.RGBA,type:y.UNSIGNED_BYTE,wrapS:y.CLAMP_TO_EDGE,wrapT:y.CLAMP_TO_EDGE})};if(this.depth){var n=y.createRenderbuffer();y.bindRenderbuffer(y.RENDERBUFFER,n),y.renderbufferStorage(y.RENDERBUFFER,y.DEPTH_COMPONENT16,this.size,this.size)}this.framebuffers=[];for(var o=0;1>o;++o){var i=y.createFramebuffer();y.bindFramebuffer(y.FRAMEBUFFER,i),y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_2D,r.texture,0),this.depth&&y.framebufferRenderbuffer(y.FRAMEBUFFER,y.DEPTH_ATTACHMENT,y.RENDERBUFFER,n);var a=y.checkFramebufferStatus(y.FRAMEBUFFER);if(a!=y.FRAMEBUFFER_COMPLETE)throw"gl.checkFramebufferStatus() returned "+WebGLDebugUtils.glEnumToString(a);this.framebuffers.push(i)}y.bindRenderbuffer(y.RENDERBUFFER,null),this.texture=r}function a(t,e){M.render(y,t-1,e-1)}function s(t,e){M.render(y,C=t-1,N=e-1)}var u=r(7),c=r(7).m4,f=r(1),l=f.Renderable,h=f.Model,d=f.Plate,m=(f.shaders,f.Shader),p=f.Allocation,v=r(32),g=f.RenderSet,_=(f.camera.BasicCamera,new f({canvas:document.getElementById("canvas"),frameRate:{element:document.getElementById("framerate")},wasd:{document:document,delta:.05,theta:-Math.PI/120}})),E=_.camera,b=_.screen,y=_.screen.gl,F=function(t){p.Float.call(this,t,4)};v(F,p.Float),F.prototype.add=function(t,e){return p.Float.prototype.add.call(this,t,e,function(t){var e=(t>>>0)%256,r=(t>>>8)%256,n=(t>>>16)%256;return[n/255,r/255,e/255,1]})},F.prototype.hitAreaFor=function(t){var e=65536*t[0]+256*t[1]+t[2];return this.members[e]};var A=function(t){this.attribute_name="hit_color",this.uniform_name="hit_colors",this.hitColorAllocation=new F(t)};A.prototype.hitAreaFor=function(t){return this.hitColorAllocation.hitAreaFor(t)},A.prototype.mixinModel=function(t){var e=this.hitColorAllocation;t.addAttribute(this.attribute_name,1,"Float32Array",function(t,r){return[e.add({id:r.hit_area},r)]}),t.uniforms[this.uniform_name]=this.hitColorAllocation.buffer};var R=function(t,e,r){m.call(this,this.wrapVertexSource(e),this.wrapFragmentSource(r)),this.hitColorAllocation=t,this.varyings.f_hit_color="vec4",this.attributes.hit_color="float",this.fragment_uniforms.hit_test="int",this.vertex_uniforms["hit_colors["+this.hitColorAllocation.slots.max+"]"]="vec4"};v(R,m),R.prototype.wrapVertexSource=function(t){return function(){return t()+"\n  f_hit_color = hit_colors[int(hit_color)];"}},R.prototype.wrapFragmentSource=function(t){return function(){return this.hit_test?" gl_FragColor = f_hit_color;  \n":t()}},R.prototype.getProgram=function(t,e){return e.hit_test?this.hit_test_program?this.hit_test_program:(this.hit_test=!0,this.hit_test_program=u.createProgramInfo(t,[this.getVertexSource(),this.getFragmentSource()])):(this.hit_test=!1,m.prototype.getProgram.call(this,t,e))};var w=new A(100),T=function(t,e,r,n){return[[t-n,e-n,r,1],[t-n,e+n,r,1],[t+n,e-n,r,1],[t+n,e+n,r,1]]},x={id:"red",color:[1,0,0,1]},B={id:"green",color:[0,1,0,1]},D={id:"blue",color:[0,0,1,1]},P={id:"white",color:[1,1,1,1]},S=n();b.addRenderable(S),S.add({color:x,hit_area:"red",allocations:{},vertices:T(.25,0,.7,.05)}),S.add({color:B,hit_area:"green",allocations:{},vertices:T(0,.25,.7,.05)}),S.add({color:D,hit_area:"blue",allocations:{},vertices:T(0,0,.9,.05)}),S.add({color:P,hit_area:"white",allocations:{},vertices:T(0,0,.7,.01)}),v(o,g),o.prototype.render=function(t,e,r){for(var n=0;1>n;++n){this.framebuffers.bind(n),this.camera=_.camera;var o=Math.max(E.frameWidth,E.frameHeight),i=new Float32Array(16);c.translate(c.scaling([o,o,1]),[2*(.5-e/E.frameWidth),-2*(.5-r/E.frameHeight),0],i),this.camera2=i,g.prototype.render.call(this,t)}this.framebuffers.unbind()},i.prototype.bind=function(t){y.bindFramebuffer(y.FRAMEBUFFER,this.framebuffers[t]),y.viewport(0,0,this.size,this.size)},i.prototype.unbind=function(){y.bindFramebuffer(y.FRAMEBUFFER,null),y.viewport(0,0,y.drawingBufferWidth||y.canvas.width,y.drawingBufferHeight||y.canvas.height)};var U=new i(2,!0);U.unbind();var M;!function(){M=new o(U);var t=new m(function(){return"  gl_Position = position; \n"},function(){return"  gl_FragColor = vec4(0.5,0.5,0.5,1.0); \n"});t.attributes.position="vec4";var e=new d(t);e.add({z:-.5});var r={};c.identity(new Float32Array(16)),c.identity(new Float32Array(16)),c.identity(new Float32Array(16));M.addRenderable({before:function(){y.clearColor(0,0,0,0),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT)},renderOrder:0});var n;M.addRenderable({before:function(){var t=new Uint8Array(16);y.readPixels(0,0,2,2,y.RGBA,y.UNSIGNED_BYTE,t),t=Array.prototype.slice.call(t,0,3),t.join(",")!=n&&console.log(w.hitAreaFor(t)),n=t.join(",")},renderOrder:999}),M.addRenderable({renderOrder:11,render:function(t){t.disable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE_MINUS_DST_ALPHA,t.DST_ALPHA,t.ONE,t.ONE);var n=e.getGeometry(t);e.drawPrep(n,r),n.draw(),t.disable(t.BLEND),t.enable(t.DEPTH_TEST)}}),M.addRenderable(S),b.addRenderable({before:function(){y.clearColor(0,0,0,0),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT)},renderOrder:0})}(),function(){var t=new m(function(){return"  v_pos       = position; \n  gl_Position = camera * vec4(position.x / 4.0, position.y / 4.0, 1.5, 1.0); \n"},function(){return"  gl_FragColor = texture2D(                            \n      texture,                                         \n      vec2(v_pos.x / 2.0 + 0.5, v_pos.y / 2.0 + 0.5)); \n"});t.attributes.position="vec4",t.fragment_uniforms.texture="sampler2D",t.vertex_uniforms.camera="mat4",t.varyings.v_pos="vec4";var e=new d(t);e.textureData={texture:U.texture},e.add({z:1});var r={};c.identity(new Float32Array(16));b.addRenderable({renderOrder:30,render:function(t){t.disable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE_MINUS_DST_ALPHA,t.DST_ALPHA,t.ONE,t.ONE),E.computeMatrix(),r.camera=E.matrix,r.texture=e.textureData.texture.texture;var n=e.getGeometry(t);e.drawPrep(n,r),n.draw(),t.disable(t.BLEND),t.enable(t.DEPTH_TEST)}})}(),b.beginFrameRendering(!1);var C,N;b.on("moved",function(){M.render(y,C,N)}),document.getElementById("canvas").addEventListener("click",function(t){var e=document.getElementById("canvas").getBoundingClientRect();a((t.clientX-e.left)/e.width*E.frameWidth,(t.clientY-e.top)/e.height*E.frameHeight)}),document.getElementById("canvas").addEventListener("mousemove",function(t){var e=document.getElementById("canvas").getBoundingClientRect();s((t.clientX-e.left)/e.width*E.frameWidth,(t.clientY-e.top)/e.height*E.frameHeight)})},32:function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}}});
//# sourceMappingURL=bundle.js.map