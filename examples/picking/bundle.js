webpackJsonp([5],{0:function(e,r,t){function o(){return new i({renderOrder:10,getUniforms:function(e,r){return e.camera=m.computeMatrix(),e},factory:function(){var e=100,r=new l.Float(e,4),t=new a.HitTestShader(h.hitColorAllocation,function(e){var r=e?"hit_test_zoom_matrix * ":"";return"  gl_Position = "+r+"camera * position; \n  f_color = colors[int(color)];              \n"},function(){return"  gl_FragColor = f_color; \n"});t.attributes.position="vec4",t.attributes.color="float",t.varyings.f_color="vec4",t.vertex_uniforms.camera="mat4",t.vertex_uniforms["colors["+e+"]"]="vec4";var o=new c(this,t,100);return h.mixinModel(o),o.addAttribute("position",4,"Float32Array",function(e,r){return r.vertices[e]}),o.addAttribute("color",1,"Float32Array",function(e,t){return[r.add(t.color,t,function(){return t.color.color})]}),o.uniforms.colors=r.buffer,o}})}var n=(t(7).m4,t(1)),a=t(34),i=n.Renderable,c=n.Model,s=n.Plate,u=n.Shader,l=n.Allocation,d=n.MouseTrack,f=new n({canvas:document.getElementById("canvas"),frameRate:{element:document.getElementById("framerate")},wasd:{document:document,delta:.05,theta:-Math.PI/120}}),m=f.camera,v=f.screen,_=f.screen.gl,h=new a.HitTestManager(_,100),p=function(e,r,t,o){return[[e-o,r-o,t,1],[e-o,r+o,t,1],[e+o,r-o,t,1],[e+o,r+o,t,1]]},E={id:"red",color:[1,0,0,1]},b={id:"green",color:[0,1,0,1]},x={id:"blue",color:[0,0,1,1]},g={id:"white",color:[1,1,1,1]};v.addRenderable({before:function(){_.clearColor(0,0,0,0),_.clear(_.COLOR_BUFFER_BIT|_.DEPTH_BUFFER_BIT)},renderOrder:0});var y=o();v.addRenderable(y),h.renderSet.addRenderable(y),y.add({color:E,hit_area:"red",allocations:{},vertices:p(.25,0,.7,.05)}),y.add({color:b,hit_area:"green",allocations:{},vertices:p(0,.25,.7,.05)}),y.add({color:x,hit_area:"blue",allocations:{},vertices:p(0,0,.9,.05)}),y.add({color:g,hit_area:"white",allocations:{},vertices:p(0,0,.7,.01)}),function(){var e=new u(function(){return"  v_pos       = position; \n  gl_Position = camera * vec4(position.x / 4.0, position.y / 4.0, 1.5, 1.0); \n"},function(){return"  gl_FragColor = texture2D(                            \n      texture,                                         \n      vec2(v_pos.x / 2.0 + 0.5, v_pos.y / 2.0 + 0.5)); \n"});e.attributes.position="vec4",e.fragment_uniforms.texture="sampler2D",e.vertex_uniforms.camera="mat4",e.varyings.v_pos="vec4";var r=h.renderSet.framebuffers.texture,t=new s(e);t.textureData={texture:r},t.add({z:1});var o={};v.addRenderable({renderOrder:30,render:function(e){e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE_MINUS_DST_ALPHA,e.DST_ALPHA,e.ONE,e.ONE),o.camera=m.computeMatrix(),o.texture=r.texture;var n=t.getGeometry(e);t.drawPrep(n,o),n.draw(),e.disable(e.BLEND),e.enable(e.DEPTH_TEST)}})}(),v.beginFrameRendering(!1);var F=new d;F.bindMouseEvents(f.screen.canvas,function(e,r){return h.test(_,m,e,r)}),v.on("moved",function(){F.track()}),F.on("mouseover",function(e){console.log("mouseover",e)}),F.on("mouseout",function(e){console.log("mouseout",e)}),F.on("mousedown",function(e){console.log("mousedown",e)}),F.on("mouseup",function(e){console.log("mouseup",e)}),F.on("mousemove",function(e){}),F.on("click",function(e){console.log("click",e)})},34:function(e,r,t){function o(e,r){this.hitTestManager=r,this.framebuffers=new n(e,2,!0),this.framebuffers.unbind(),u.call(this)}function n(e,r,t){this.gl=e,this.size=r,this.depth=t;var o={texture:l.createTexture(e,{target:e.TEXTURE_2D,width:this.size,height:this.size,min:e.LINEAR,mag:e.LINEAR,format:e.RGBA,type:e.UNSIGNED_BYTE,wrapS:e.CLAMP_TO_EDGE,wrapT:e.CLAMP_TO_EDGE})};if(this.depth){var n=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,n),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,this.size,this.size)}var a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o.texture,0),this.depth&&e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,n);var i=e.checkFramebufferStatus(e.FRAMEBUFFER);if(i!=e.FRAMEBUFFER_COMPLETE)throw"gl.checkFramebufferStatus() returned "+WebGLDebugUtils.glEnumToString(i);this.framebuffer=a,e.bindRenderbuffer(e.RENDERBUFFER,null),this.texture=o}var a=t(35),i=t(1),c=i.Allocation,s=i.Shader,u=i.RenderSet,l=t(7),d=l.m4,f=function(e){c.Float.call(this,e,4)};a(f,c.Float),f.prototype.add=function(e,r){return c.Float.prototype.add.call(this,e,r,function(e){var r=(e>>>0)%256,t=(e>>>8)%256,o=(e>>>16)%256;return[o/255,t/255,r/255,1]})},f.prototype.hitAreaFor=function(e){var r=65536*e[0]+256*e[1]+e[2];return this.members[r]};var m=function(e,r){this.attribute_name="hit_color",this.uniform_name="hit_colors",this.hitColorAllocation=new f(r),this.renderSet=new o(e,this)};m.prototype.test=function(e,r,t,o){var n=this.renderSet.render(e,r,t,o);return this.hitColorAllocation.hitAreaFor(n)},m.prototype.mixinModel=function(e){var r=this.hitColorAllocation;e.addAttribute(this.attribute_name,1,"Float32Array",function(e,t){return[r.add({id:t.hit_area},t)]}),e.uniforms[this.uniform_name]=this.hitColorAllocation.buffer};var v=function(e,r,t){s.call(this,this.wrapVertexSource(r),this.wrapFragmentSource(t)),this.hitColorAllocation=e,this.varyings.f_hit_color="vec4",this.attributes.hit_color="float",this.vertex_uniforms.hit_test_zoom_matrix="mat4",this.vertex_uniforms["hit_colors["+this.hitColorAllocation.slots.max+"]"]="vec4"};a(v,s),v.prototype.wrapVertexSource=function(e){return function(){return e(this.hit_test)+"\n  f_hit_color = hit_colors[int(hit_color)];"}},v.prototype.wrapFragmentSource=function(e){return function(){return this.hit_test?" gl_FragColor = f_hit_color;  \n":e()}},v.prototype.getProgram=function(e,r){return r.hit_test_zoom_matrix?this.hit_test_program?this.hit_test_program:(this.hit_test=!0,this.hit_test_program=l.createProgramInfo(e,[this.getVertexSource(),this.getFragmentSource()])):(this.hit_test=!1,s.prototype.getProgram.call(this,e,r))},a(o,u),o.prototype.getUniforms=function(){return{hit_test_zoom_matrix:this.hit_test_zoom_matrix}},o.prototype.render=function(e,r,t,o){this.framebuffers.bind();var n=Math.max(r.frameWidth,r.frameHeight),a=new Float32Array(16);d.translate(d.scaling([n,n,1]),[2*(.5-t/r.frameWidth),-2*(.5-o/r.frameHeight),0],a),this.hit_test_zoom_matrix=a,e.clearColor(1,1,1,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),u.prototype.render.call(this,e);var i=new Uint8Array(16);return e.readPixels(0,0,2,2,e.RGBA,e.UNSIGNED_BYTE,i),i=Array.prototype.slice.call(i,0,3),this.framebuffers.unbind(),i},n.prototype.bind=function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer),e.viewport(0,0,this.size,this.size)},n.prototype.unbind=function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.drawingBufferWidth||e.canvas.width,e.drawingBufferHeight||e.canvas.height)},e.exports.HitTestShader=v,e.exports.HitTestManager=m},35:function(e,r){"function"==typeof Object.create?e.exports=function(e,r){e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,r){e.super_=r;var t=function(){};t.prototype=r.prototype,e.prototype=new t,e.prototype.constructor=e}}});
//# sourceMappingURL=bundle.js.map