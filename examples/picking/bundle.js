webpackJsonp([1],[function(e,r,t){function n(){return new f({renderOrder:10,getUniforms:function(){return{camera:b.computeMatrix()}},factory:function(){var e=100,r=new m.Float(e,4),t=new E(function(){return"  gl_Position = camera * position; \n  f_color = colors[int(color)]; \n"},function(){return"  gl_FragColor = f_color ;\n"});t.attributes.position="vec4",t.attributes.color="float",t.varyings.f_color="vec4",t.vertex_uniforms.camera="mat4",t.vertex_uniforms["colors["+e+"]"]="vec4";var n=new d(this,t,100);return n.addAttribute("position",4,"Float32Array",function(e,r){return r.vertices[e]}),n.addAttribute("color",1,"Float32Array",function(e,t){return[r.add(t.color,t,function(){return t.color.color})]}),n.uniforms.colors=r.buffer,n}})}function a(e){this.framebuffers=e,this.cameras=[],this.camera=null;for(var r=0;1>r;++r){var t;this.cameras.push(t=new h(e.size,e.size,.1,4096)),t.setFOV(90,!0)}this.camera=t,this.camera.rotateBy(0,Math.PI,0),_.call(this)}function i(e,r){var t=[R.TEXTURE_CUBE_MAP_POSITIVE_X,R.TEXTURE_CUBE_MAP_NEGATIVE_X,R.TEXTURE_CUBE_MAP_POSITIVE_Y,R.TEXTURE_CUBE_MAP_NEGATIVE_Y,R.TEXTURE_CUBE_MAP_POSITIVE_Z,R.TEXTURE_CUBE_MAP_NEGATIVE_Z];this.size=e,this.depth=r;var n={texture:s.createTexture(R,{target:R.TEXTURE_CUBE_MAP,width:this.size,height:this.size,min:R.LINEAR,mag:R.LINEAR,format:R.RGBA,type:R.UNSIGNED_BYTE,wrapS:R.CLAMP_TO_EDGE,wrapT:R.CLAMP_TO_EDGE})};if(this.depth){var a=R.createRenderbuffer();R.bindRenderbuffer(R.RENDERBUFFER,a),R.renderbufferStorage(R.RENDERBUFFER,R.DEPTH_COMPONENT16,this.size,this.size)}this.framebuffers=[];for(var i=0;1>i;++i){var o=R.createFramebuffer();R.bindFramebuffer(R.FRAMEBUFFER,o),R.framebufferTexture2D(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0,t[4],n.texture,0),this.depth&&R.framebufferRenderbuffer(R.FRAMEBUFFER,R.DEPTH_ATTACHMENT,R.RENDERBUFFER,a);var c=R.checkFramebufferStatus(R.FRAMEBUFFER);if(c!=R.FRAMEBUFFER_COMPLETE)throw"gl.checkFramebufferStatus() returned "+WebGLDebugUtils.glEnumToString(c);this.framebuffers.push(o)}R.bindRenderbuffer(R.RENDERBUFFER,null),this.texture=n}function o(e,r){console.log(Math.floor(e),Math.floor(r))}var s=t(7),c=t(7).m4,u=t(1),f=u.Renderable,d=u.Model,l=u.Plate,E=(u.shaders,u.Shader),m=u.Allocation,v=t(3),_=u.RenderSet,h=u.camera.BasicCamera,p=new u({canvas:document.getElementById("canvas"),frameRate:{element:document.getElementById("framerate")},wasd:{document:document,delta:.05,theta:-Math.PI/120}}),b=p.camera,F=p.screen,R=p.screen.gl,T=function(e,r,t,n){return[[e-n,r-n,t,1],[e-n,r+n,t,1],[e+n,r-n,t,1],[e+n,r+n,t,1]]},g={id:"red",color:[1,0,0,1]},A={id:"green",color:[0,1,0,1]},y={id:"blue",color:[0,0,1,1]},w={id:"white",color:[1,1,1,1]},B=n();F.addRenderable(B),B.add({color:g,allocations:{},vertices:T(.25,0,.7,.05)}),B.add({color:A,allocations:{},vertices:T(0,.25,.7,.05)}),B.add({color:y,allocations:{},vertices:T(0,0,.9,.05)}),B.add({color:w,allocations:{},vertices:T(0,0,.7,.01)}),v.inherits(a,_),a.prototype.render=function(e){for(var r=0;1>r;++r)this.framebuffers.bind(r),this.camera=this.cameras[r],_.prototype.render.call(this,e);this.framebuffers.unbind()},i.prototype.bind=function(e){R.bindFramebuffer(R.FRAMEBUFFER,this.framebuffers[e]),R.viewport(0,0,this.size,this.size)},i.prototype.unbind=function(){R.bindFramebuffer(R.FRAMEBUFFER,null),R.viewport(0,0,R.drawingBufferWidth||R.canvas.width,R.drawingBufferHeight||R.canvas.height)};var U=new i(1024,!0);U.unbind(),function(){var e=new a(U),r=new E(function(){return"  gl_Position = position; \n  v_position  = inverse_camera * position; \n"},function(){return"  gl_FragColor = vec4(                                               \n   (v_position.x + 1.0) / 2.0,                                       \n   (v_position.y + 1.0) / 2.0,                                       \n   (v_position.z + 1.0) / 2.0,                                       \n   1.0);                                                             \n"});r.attributes.position="vec4",r.vertex_uniforms.inverse_camera="mat4",r.varyings.v_position="vec4";var t=new l(r);t.add({z:-.5});var n={},i=c.identity(new Float32Array(16)),o=c.identity(new Float32Array(16)),s=c.identity(new Float32Array(16));e.addRenderable({before:function(){R.clearColor(0,0,0,0),R.clear(R.COLOR_BUFFER_BIT|R.DEPTH_BUFFER_BIT)},renderOrder:0}),e.addRenderable({renderOrder:11,render:function(r){r.disable(r.DEPTH_TEST),r.enable(r.BLEND),r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD),r.blendFuncSeparate(r.ONE_MINUS_DST_ALPHA,r.DST_ALPHA,r.ONE,r.ONE),e.camera.computeMatrix(),c.inverse(e.camera.perspective,i),c.inverse(e.camera.skyorientation,o),c.multiply(i,o,s),n.inverse_camera=s;var a=t.getGeometry(r);t.drawPrep(a,n),a.draw(),r.disable(r.BLEND),r.enable(r.DEPTH_TEST)}}),e.addRenderable(B),F.addRenderable({before:function(){R.clearColor(0,0,0,0),R.clear(R.COLOR_BUFFER_BIT|R.DEPTH_BUFFER_BIT)},renderOrder:0}),F.addRenderable({renderOrder:20,render:function(r){e.render(r)}})}(),function(){var e=new E(function(){return"  v_pos       = camera * position; \n  gl_Position = vec4(position.x, position.y, 0.5, 1.0); \n"},function(){return"  gl_FragColor = textureCube(                            \n      texture,                                           \n      vec3(v_pos.xyz / v_pos.w));                        \n"});e.attributes.position="vec4",e.fragment_uniforms.texture="samplerCube",e.vertex_uniforms.camera="mat4",e.varyings.v_pos="vec4";var r=new l(e);r.textureData={texture:U.texture},r.add({z:1});var t={},n=c.identity(new Float32Array(16));F.addRenderable({renderOrder:30,render:function(e){e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE_MINUS_DST_ALPHA,e.DST_ALPHA,e.ONE,e.ONE),b.computeMatrix(),c.inverse(b.skymatrix,n),t.camera=n,t.texture=r.textureData.texture.texture;var a=r.getGeometry(e);r.drawPrep(a,t),a.draw(),e.disable(e.BLEND),e.enable(e.DEPTH_TEST)}})}(),F.beginFrameRendering(!1),document.getElementById("canvas").addEventListener("click",function(e){var r=document.getElementById("canvas").getBoundingClientRect();o((e.clientX-r.left)/r.width*b.frameWidth,(e.clientY-r.top)/r.height*b.frameHeight)})}]);
//# sourceMappingURL=bundle.js.map