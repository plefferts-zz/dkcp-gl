webpackJsonp([1],{0:function(e,t,r){function n(){var e=a.identity(new Float32Array(16));return new s({renderOrder:10,getUniforms:function(t){return t==_?{camera:p.computeMatrix(),camera2:e,hit_test:0}:{camera:p.computeMatrix(),camera2:t.camera2,hit_test:1}},factory:function(){var e=100,t=new h.Float(e,4),r=new u.HitTestShader(v.hitColorAllocation,function(){return"  gl_Position = camera2 * camera * position; \n  f_color = colors[int(color)];              \n"},function(){return"  gl_FragColor = f_color; \n"});r.attributes.position="vec4",r.attributes.color="float",r.varyings.f_color="vec4",r.vertex_uniforms.camera="mat4",r.vertex_uniforms.camera2="mat4",r.vertex_uniforms["colors["+e+"]"]="vec4";var n=new l(this,r,100);return v.mixinModel(n),n.addAttribute("position",4,"Float32Array",function(e,t){return t.vertices[e]}),n.addAttribute("color",1,"Float32Array",function(e,r){return[t.add(r.color,r,function(){return r.color.color})]}),n.uniforms.colors=t.buffer,n}})}function o(e,t){T.render(g,p,e-1,t-1)}function i(e,t){T.render(g,p,w=e-1,x=t-1)}var a=r(7).m4,c=r(1),u=r(33),s=c.Renderable,l=c.Model,f=c.Plate,d=c.Shader,h=c.Allocation,m=new c({canvas:document.getElementById("canvas"),frameRate:{element:document.getElementById("framerate")},wasd:{document:document,delta:.05,theta:-Math.PI/120}}),p=m.camera,_=m.screen,g=m.screen.gl,v=new u.HitTestManager(g,100),E=function(e,t,r,n){return[[e-n,t-n,r,1],[e-n,t+n,r,1],[e+n,t-n,r,1],[e+n,t+n,r,1]]},b={id:"red",color:[1,0,0,1]},F={id:"green",color:[0,1,0,1]},y={id:"blue",color:[0,0,1,1]},R={id:"white",color:[1,1,1,1]};_.addRenderable({before:function(){g.clearColor(0,0,0,0),g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT)},renderOrder:0});var A=n();_.addRenderable(A),A.add({color:b,hit_area:"red",allocations:{},vertices:E(.25,0,.7,.05)}),A.add({color:F,hit_area:"green",allocations:{},vertices:E(0,.25,.7,.05)}),A.add({color:y,hit_area:"blue",allocations:{},vertices:E(0,0,.9,.05)}),A.add({color:R,hit_area:"white",allocations:{},vertices:E(0,0,.7,.01)});var T;!function(){T=v.renderSet,T.addRenderable({before:function(){g.clearColor(1,1,1,1),g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT)},renderOrder:0});var e;T.addRenderable({before:function(){var t=new Uint8Array(16);g.readPixels(0,0,2,2,g.RGBA,g.UNSIGNED_BYTE,t),t=Array.prototype.slice.call(t,0,3),t.join(",")!=e&&console.log(v.hitAreaFor(t)),e=t.join(",")},renderOrder:999}),T.addRenderable(A)}(),function(){var e=new d(function(){return"  v_pos       = position; \n  gl_Position = camera * vec4(position.x / 4.0, position.y / 4.0, 1.5, 1.0); \n"},function(){return"  gl_FragColor = texture2D(                            \n      texture,                                         \n      vec2(v_pos.x / 2.0 + 0.5, v_pos.y / 2.0 + 0.5)); \n"});e.attributes.position="vec4",e.fragment_uniforms.texture="sampler2D",e.vertex_uniforms.camera="mat4",e.varyings.v_pos="vec4";var t=new f(e);t.textureData={texture:T.framebuffers.texture},t.add({z:1});var r={};_.addRenderable({renderOrder:30,render:function(e){e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE_MINUS_DST_ALPHA,e.DST_ALPHA,e.ONE,e.ONE),r.camera=p.computeMatrix(),r.texture=t.textureData.texture.texture;var n=t.getGeometry(e);t.drawPrep(n,r),n.draw(),e.disable(e.BLEND),e.enable(e.DEPTH_TEST)}})}(),_.beginFrameRendering(!1);var w,x;_.on("moved",function(){T.render(g,p,w,x)}),document.getElementById("canvas").addEventListener("click",function(e){var t=document.getElementById("canvas").getBoundingClientRect();o((e.clientX-t.left)/t.width*p.frameWidth,(e.clientY-t.top)/t.height*p.frameHeight)}),document.getElementById("canvas").addEventListener("mousemove",function(e){var t=document.getElementById("canvas").getBoundingClientRect();i((e.clientX-t.left)/t.width*p.frameWidth,(e.clientY-t.top)/t.height*p.frameHeight)})},32:function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},33:function(e,t,r){function n(e,t){this.framebuffers=new o(e,2,!0),this.framebuffers.unbind(),s.call(this)}function o(e,t,r){this.gl=e,this.size=t,this.depth=r;var n={texture:l.createTexture(e,{target:e.TEXTURE_2D,width:this.size,height:this.size,min:e.LINEAR,mag:e.LINEAR,format:e.RGBA,type:e.UNSIGNED_BYTE,wrapS:e.CLAMP_TO_EDGE,wrapT:e.CLAMP_TO_EDGE})};if(this.depth){var o=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,o),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,this.size,this.size)}var i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n.texture,0),this.depth&&e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,o);var a=e.checkFramebufferStatus(e.FRAMEBUFFER);if(a!=e.FRAMEBUFFER_COMPLETE)throw"gl.checkFramebufferStatus() returned "+WebGLDebugUtils.glEnumToString(a);this.framebuffer=i,e.bindRenderbuffer(e.RENDERBUFFER,null),this.texture=n}var i=r(32),a=r(1),c=a.Allocation,u=a.Shader,s=a.RenderSet,l=r(7),f=l.m4,d=function(e){c.Float.call(this,e,4)};i(d,c.Float),d.prototype.add=function(e,t){return c.Float.prototype.add.call(this,e,t,function(e){var t=(e>>>0)%256,r=(e>>>8)%256,n=(e>>>16)%256;return[n/255,r/255,t/255,1]})},d.prototype.hitAreaFor=function(e){var t=65536*e[0]+256*e[1]+e[2];return this.members[t]};var h=function(e,t){this.attribute_name="hit_color",this.uniform_name="hit_colors",this.hitColorAllocation=new d(t),this.renderSet=new n(e)};h.prototype.hitAreaFor=function(e){return this.hitColorAllocation.hitAreaFor(e)},h.prototype.mixinModel=function(e){var t=this.hitColorAllocation;e.addAttribute(this.attribute_name,1,"Float32Array",function(e,r){return[t.add({id:r.hit_area},r)]}),e.uniforms[this.uniform_name]=this.hitColorAllocation.buffer};var m=function(e,t,r){u.call(this,this.wrapVertexSource(t),this.wrapFragmentSource(r)),this.hitColorAllocation=e,this.varyings.f_hit_color="vec4",this.attributes.hit_color="float",this.fragment_uniforms.hit_test="int",this.vertex_uniforms["hit_colors["+this.hitColorAllocation.slots.max+"]"]="vec4"};i(m,u),m.prototype.wrapVertexSource=function(e){return function(){return e()+"\n  f_hit_color = hit_colors[int(hit_color)];"}},m.prototype.wrapFragmentSource=function(e){return function(){return this.hit_test?" gl_FragColor = f_hit_color;  \n":e()}},m.prototype.getProgram=function(e,t){return t.hit_test?this.hit_test_program?this.hit_test_program:(this.hit_test=!0,this.hit_test_program=l.createProgramInfo(e,[this.getVertexSource(),this.getFragmentSource()])):(this.hit_test=!1,u.prototype.getProgram.call(this,e,t))},i(n,s),n.prototype.render=function(e,t,r,n){this.framebuffers.bind();var o=Math.max(t.frameWidth,t.frameHeight),i=new Float32Array(16);f.translate(f.scaling([o,o,1]),[2*(.5-r/t.frameWidth),-2*(.5-n/t.frameHeight),0],i),this.camera2=i,s.prototype.render.call(this,e),this.framebuffers.unbind()},o.prototype.bind=function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer),e.viewport(0,0,this.size,this.size)},o.prototype.unbind=function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.drawingBufferWidth||e.canvas.width,e.drawingBufferHeight||e.canvas.height)},e.exports.HitTestShader=m,e.exports.HitTestManager=h}});
//# sourceMappingURL=bundle.js.map