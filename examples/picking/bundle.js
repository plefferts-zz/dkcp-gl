webpackJsonp([1],[function(e,t,r){function n(){var e=c.identity(new Float32Array(16));return new l({renderOrder:10,getUniforms:function(t){return t==_?{camera:g.computeMatrix(),camera2:e,hit_test:0}:{camera:t.camera.computeMatrix(),camera2:t.camera2,hit_test:1}},factory:function(){var e=100,t=new p.Float(e,4),r=new m(function(){return"  gl_Position = camera2 * camera * position; \n  f_hit_color = colors[int(hit_color)];      \n  f_color = colors[int(color)];              \n"},function(){return"  if (hit_test > 0) {            \n    gl_FragColor = f_hit_color;  \n   } else {                      \n    gl_FragColor = f_color;      \n   }                             \n"});r.attributes.position="vec4",r.attributes.color="float",r.varyings.f_color="vec4",r.varyings.f_hit_color="vec4",r.attributes.hit_color="float",r.fragment_uniforms.hit_test="int",r.vertex_uniforms.camera="mat4",r.vertex_uniforms.camera2="mat4",r.vertex_uniforms["colors["+e+"]"]="vec4";var n=new d(this,r,100);return n.addAttribute("position",4,"Float32Array",function(e,t){return t.vertices[e]}),n.addAttribute("color",1,"Float32Array",function(e,r){return[t.add(r.color,r,function(){return r.color.color})]}),n.addAttribute("hit_color",1,"Float32Array",function(e,r){return[t.add(r.hit_color,r,function(){return r.hit_color.color})]}),n.uniforms.colors=t.buffer,n}})}function i(e){this.framebuffers=e,E.call(this)}function a(e,t){this.size=e,this.depth=t;var r={texture:u.createTexture(y,{target:y.TEXTURE_2D,width:this.size,height:this.size,min:y.LINEAR,mag:y.LINEAR,format:y.RGBA,type:y.UNSIGNED_BYTE,wrapS:y.CLAMP_TO_EDGE,wrapT:y.CLAMP_TO_EDGE})};if(this.depth){var n=y.createRenderbuffer();y.bindRenderbuffer(y.RENDERBUFFER,n),y.renderbufferStorage(y.RENDERBUFFER,y.DEPTH_COMPONENT16,this.size,this.size)}this.framebuffers=[];for(var i=0;1>i;++i){var a=y.createFramebuffer();y.bindFramebuffer(y.FRAMEBUFFER,a),y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_2D,r.texture,0),this.depth&&y.framebufferRenderbuffer(y.FRAMEBUFFER,y.DEPTH_ATTACHMENT,y.RENDERBUFFER,n);var o=y.checkFramebufferStatus(y.FRAMEBUFFER);if(o!=y.FRAMEBUFFER_COMPLETE)throw"gl.checkFramebufferStatus() returned "+WebGLDebugUtils.glEnumToString(o);this.framebuffers.push(a)}y.bindRenderbuffer(y.RENDERBUFFER,null),this.texture=r}function o(e,t){N.render(y,e-1,t-1)}function s(e,t){N.render(y,S=e-1,O=t-1)}var u=r(7),c=r(7).m4,f=r(1),l=f.Renderable,d=f.Model,h=f.Plate,m=(f.shaders,f.Shader),p=f.Allocation,v=r(3),E=f.RenderSet,b=(f.camera.BasicCamera,new f({canvas:document.getElementById("canvas"),frameRate:{element:document.getElementById("framerate")},wasd:{document:document,delta:.05,theta:-Math.PI/120}})),g=b.camera,_=b.screen,y=b.screen.gl,F=function(e,t,r,n){return[[e-n,t-n,r,1],[e-n,t+n,r,1],[e+n,t-n,r,1],[e+n,t+n,r,1]]},R={id:"red",color:[1,0,0,1]},T={id:"green",color:[0,1,0,1]},A={id:"blue",color:[0,0,1,1]},w={id:"white",color:[1,1,1,1]},B={id:"yellow",color:[1,1,0,1]},x={id:"cyan",color:[0,1,1,1]},D={id:"magenta",color:[1,0,1,1]},U={id:"black",color:[0,0,0,1]},P=n();_.addRenderable(P),P.add({color:R,hit_color:x,allocations:{},vertices:F(.25,0,.7,.05)}),P.add({color:T,hit_color:D,allocations:{},vertices:F(0,.25,.7,.05)}),P.add({color:A,hit_color:B,allocations:{},vertices:F(0,0,.9,.05)}),P.add({color:w,hit_color:U,allocations:{},vertices:F(0,0,.7,.01)}),v.inherits(i,E),i.prototype.render=function(e,t,r){for(var n=0;1>n;++n){this.framebuffers.bind(n),this.camera=b.camera;var i=Math.max(g.frameWidth,g.frameHeight),a=new Float32Array(16);c.translate(c.scaling([i,i,1]),[2*(.5-t/g.frameWidth),-2*(.5-r/g.frameHeight),0],a),this.camera2=a,E.prototype.render.call(this,e)}this.framebuffers.unbind()},a.prototype.bind=function(e){y.bindFramebuffer(y.FRAMEBUFFER,this.framebuffers[e]),y.viewport(0,0,this.size,this.size)},a.prototype.unbind=function(){y.bindFramebuffer(y.FRAMEBUFFER,null),y.viewport(0,0,y.drawingBufferWidth||y.canvas.width,y.drawingBufferHeight||y.canvas.height)};var M=new a(2,!0);M.unbind();var N;!function(){N=new i(M);var e=new m(function(){return"  gl_Position = position; \n"},function(){return"  gl_FragColor = vec4(0.5,0.5,0.5,1.0); \n"});e.attributes.position="vec4";var t=new h(e);t.add({z:-.5});var r={};c.identity(new Float32Array(16)),c.identity(new Float32Array(16)),c.identity(new Float32Array(16));N.addRenderable({before:function(){y.clearColor(0,0,0,0),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT)},renderOrder:0});var n;N.addRenderable({before:function(){var e=new Uint8Array(16);y.readPixels(0,0,2,2,y.RGBA,y.UNSIGNED_BYTE,e),e=Array.prototype.slice.call(e,0,3),e.join(",")!=n&&console.log(e),n=e.join(",")},renderOrder:999}),N.addRenderable({renderOrder:11,render:function(e){e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE_MINUS_DST_ALPHA,e.DST_ALPHA,e.ONE,e.ONE);var n=t.getGeometry(e);t.drawPrep(n,r),n.draw(),e.disable(e.BLEND),e.enable(e.DEPTH_TEST)}}),N.addRenderable(P),_.addRenderable({before:function(){y.clearColor(0,0,0,0),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT)},renderOrder:0})}(),function(){var e=new m(function(){return"  v_pos       = position; \n  gl_Position = camera * vec4(position.x / 4.0, position.y / 4.0, 1.5, 1.0); \n"},function(){return"  gl_FragColor = texture2D(                            \n      texture,                                         \n      vec2(v_pos.x / 2.0 + 0.5, v_pos.y / 2.0 + 0.5)); \n"});e.attributes.position="vec4",e.fragment_uniforms.texture="sampler2D",e.vertex_uniforms.camera="mat4",e.varyings.v_pos="vec4";var t=new h(e);t.textureData={texture:M.texture},t.add({z:1});var r={};c.identity(new Float32Array(16));_.addRenderable({renderOrder:30,render:function(e){e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE_MINUS_DST_ALPHA,e.DST_ALPHA,e.ONE,e.ONE),g.computeMatrix(),r.camera=g.matrix,r.texture=t.textureData.texture.texture;var n=t.getGeometry(e);t.drawPrep(n,r),n.draw(),e.disable(e.BLEND),e.enable(e.DEPTH_TEST)}})}(),_.beginFrameRendering(!1);var S,O;_.on("moved",function(){N.render(y,S,O)}),document.getElementById("canvas").addEventListener("click",function(e){var t=document.getElementById("canvas").getBoundingClientRect();o((e.clientX-t.left)/t.width*g.frameWidth,(e.clientY-t.top)/t.height*g.frameHeight)}),document.getElementById("canvas").addEventListener("mousemove",function(e){var t=document.getElementById("canvas").getBoundingClientRect();s((e.clientX-t.left)/t.width*g.frameWidth,(e.clientY-t.top)/t.height*g.frameHeight)})}]);
//# sourceMappingURL=bundle.js.map